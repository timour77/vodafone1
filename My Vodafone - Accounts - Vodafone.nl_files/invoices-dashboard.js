VF.namespace("VF.pages.invoicesDashboard"),VF.pages.invoicesDashboard=function(){"use strict";function r(){1===VF.core.globals.features["consumer.invoices.core"]&&(c=$.localStorage.getItem("current_billing_customer"),null!==c&&(f=VF.core.globals.account.billing_customers[c].billing_customer_id,s.set("billingCustomerId",f),h=VF.core.globals.account.billing_customers[c].is_consumer,u=h?"amount_including_vat":"amount_excluding_vat",$("#invoicesContainer").loadingIndicator("show"),s.getAllBills().done(e).fail(t),$(document).on("click",".invoice-collapse-toggle",n).on("click",".bills-table-row",i).on("click",".bills-table-subscriptions-row",i).on("click","#moreInvoicesBtn",l).on("click",".js-pdf-download-tag",function(){VF.core.tag().trackButtonClick("my:rekeningen:rekening:download rekening PDF")})))}function e(r){$.when(s.getAllNotes(3),s.getCurrentBillingArrangement()).done(function(e,t){$(".js-page-error").toggle(!1),$(".content").removeClass("preloader"),$(".js-ba-error").toggle(!t.is_active),$(".js-no-invoices").toggle(0===r.length),$(".js-notes").toggle(0!==r.length);var n=$("#invoicesContainer");$.each(r,function(e,t){r[e].payment=VF.pages.my.invoiceGeneral.getPaymentInfo(t,h)}),VF.template.compile("invoices",{billingCustomerId:f,currentBillingArrangement:t,isConsumer:h,invoices:r},function(r){n.html(r).loadingIndicator("hide"),n.find("table").stickytable("refresh"),a.render(function(r){$("#invoicesContainer .billing-header").prepend(r),$("#ba-wrapper").addClass("pull-right")})});var i=$("#otherBills");i.loadingIndicator("show"),VF.template.compile("other-bills",{isConsumer:h,billingCustomerId:f,notes:e,recentNotes:e.slice(0,2)},function(r){i.html(r).loadingIndicator("hide"),VF.core.formOfAddress().setFormOfAddress()});var l=$(".payment-details");l.loadingIndicator("show"),VF.template.compile("payment-details",{billingCustomerId:f,billingArrangement:t},function(r){l.html(r).loadingIndicator("hide"),o(),$("#invoice-settings-inactive-alert").remove()})}).fail(t)}function t(r){$(".js-page-error").toggle(!0),$(".content").removeClass("preloader"),$("#invoicesContainer").loadingIndicator("hide")}function o(){VF.util.device().isKnownMobile()||$(window).width()<750||$(".billing-widgets .row-fluid").each(function(){var r=$(this),e=r.find(".billing-widget"),t=".billing-widget-content",o=0;e.length<=1||(e.each(function(){var r=$(this),e=r.find(t).outerHeight();e>o&&(o=e)}),e.find(t).css({height:o}))})}function n(r){r.preventDefault(),r.stopPropagation();var e=$(this),t=e.find(".bar-loader"),o=e.parents("tr"),n=o.next().find(".inner"),i=o.data("invoice-number"),l=o.data("invoice-name");return o.hasClass("collapse-row")?(o.toggleClass("collapse-row"),void VF.core.tag().trackExpanderClick("toon-abonnementen-"+l+"-close")):(VF.core.tag().trackExpanderClick("toon-abonnementen-"+l+"-open"),t.toggleClass("hidden",!1),void s.getInvoice(i).done(function(r){VF.template.compile("invoice-details",r,function(r){o.toggleClass("collapse-row").siblings().removeClass("collapse-row"),n.html(r),t.toggleClass("hidden",!0)})}).fail(function(r){t.toggleClass("hidden",!0),log(r)}))}function i(r){window.location=$(r.currentTarget).data("href")}function l(r){r.preventDefault();var e=$(r.currentTarget),t=$("#invoicesContainer"),o=t.find(".initially-hidden");o.is(":visible")?(o.hide(),e.text(e.data("show-text")),VF.core.tag().trackButtonClick("my:rekeningen:oudere-rekeningen:close")):(o.show(e.data("hide-text")),e.text(e.data("hide-text")),VF.core.tag().trackButtonClick("my:rekeningen:oudere-rekeningen:open")),t.find("table").stickytable("refresh")}function p(r,o){s.set("billingArrangementId",o),s.getAllBills().done(e).fail(t)}var s=new VF.services.billing.InvoicesService;s.set("billingArrangementId",$.localStorage.getItem("current_billing_arrangement"));var a=new VF.pages.my.invoiceGeneral.BillingArrangementSelector;a.setService(s),a.on("change",p);var c,f,h,u;return{init:r}}(),VF.core.globals.callbacks.my_account.push(function(){VF.pages.invoicesDashboard.init()}),$(document).ready(function(){VF.core.features().processFeature("consumer.invoices.core")});